{% extends "base.html" %}
{% block title %}AcademicPro - Home{% endblock %}
{% block content %}
<section class="home-hero text-center py-5">
  <h1 class="display-5 fw-bold">Expert Academic Support, Anytime You Need It</h1>
  <p class="lead text-muted">Fast, affordable, and confidential writing help for students worldwide.</p>
  <div class="d-flex justify-content-center gap-2 flex-wrap">
    <a href="{{ url_for('main.order') }}" class="btn btn-primary btn-lg">Order Now</a>
    <a href="{{ url_for('main.public_writers') }}" class="btn btn-outline-primary btn-lg">View Writers</a>
  </div>
</section>

<section class="mb-5">
  <div class="row g-3 text-center">
    <div class="col-md-3"><div class="tile-soft"><div class="metric-value">1200+</div><div class="metric-label">Students Supported</div></div></div>
    <div class="col-md-3"><div class="tile-soft"><div class="metric-value">3500</div><div class="metric-label">Papers Delivered</div></div></div>
    <div class="col-md-3"><div class="tile-soft"><div class="metric-value">96%</div><div class="metric-label">On-Time Success</div></div></div>
    <div class="col-md-3"><div class="tile-soft text-start small"><div>✔ SSL Secure Portal</div><div>✔ Free Similarity Report Included</div><div>✔ Confidentiality Guaranteed</div></div></div>
  </div>
</section>

<section class="mb-5">
  <h2 class="section-title text-center">Trust & Transparency</h2>
  <div class="row g-3">
    <div class="col-md-4"><div class="tile-soft h-100"><h5>Plagiarism Report Included</h5><p class="mb-0">Every completed order includes a similarity report summary for transparency and quality assurance.</p></div></div>
    <div class="col-md-4"><div class="tile-soft h-100"><h5>Money-Back & Revision Policy</h5><p class="mb-2">Clear terms for refunds and revisions reduce client risk.</p><a href="{{ url_for('main.payment_policy') }}">View policy</a></div></div>
    <div class="col-md-4"><div class="tile-soft h-100"><h5>Professional Standards</h5><p class="mb-0">Our internal quality process follows academic integrity, formatting accuracy, and deadline discipline.</p></div></div>
  </div>
</section>

<section class="mb-5">
  <h2 class="section-title text-center">How It Works</h2>
  <div class="row g-4">
    <div class="col-md-6"><div class="how-card"><h5>Submit Instructions</h5><p>Share your topic, length, and deadline.</p></div></div>
    <div class="col-md-6"><div class="how-card"><h5>Choose Writer</h5><p>Select from top-rated experts in your field.</p></div></div>
    <div class="col-md-6"><div class="how-card"><h5>Deposit Payment</h5><p>Securely confirm your order.</p></div></div>
    <div class="col-md-6"><div class="how-card"><h5>Revise & Release</h5><p>Review, request changes, and approve final draft.</p></div></div>
  </div>
</section>

<section class="mb-5" id="services">
  <h2 class="section-title">Our Services</h2>
  <div class="row g-3">
    <div class="col-md-6 col-lg-3"><div class="writer-card h-100"><h5>Essay Writing</h5><p>Narrative, persuasive, analytical, and more.</p></div></div>
    <div class="col-md-6 col-lg-3"><div class="writer-card h-100"><h5>Research Papers</h5><p>In-depth, well-cited academic research.</p></div></div>
    <div class="col-md-6 col-lg-3"><div class="writer-card h-100"><h5>Dissertations</h5><p>Comprehensive support for advanced projects.</p></div></div>
    <div class="col-md-6 col-lg-3"><div class="writer-card h-100"><h5>Assignments</h5><p>Reliable help for coursework and homework.</p></div></div>
  </div>
</section>

<section class="mb-5" id="writers">
  <h2 class="section-title">Meet Our Writers</h2>
  <div class="row g-3">
    {% if writers %}
      {% for w in writers %}
        <div class="col-md-4">
          <div class="writer-card h-100">
            <h5>{{ w.name }}</h5>
            <p class="text-muted">{{ w.subject or 'Academic Specialist' }}</p>
            <p class="small text-muted">Rating: {{ w.rating or 0 }} / 5 · {{ review_counts.get(w.id, 0) }} reviews</p>
            <p class="mb-0">Trusted by students for clarity, structure, and on-time delivery.</p>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="col-12"><div class="tile-soft">No approved writers yet.</div></div>
    {% endif %}
  </div>
</section>

<section class="mb-5" id="testimonials">
  <h2 class="section-title">Testimonials</h2>
  <div class="row g-3">
    <div class="col-md-6"><div class="tile-soft h-100"><p>"AcademicPro helped me meet my deadline and improve my grade. The process was smooth and professional."</p><small>- Sarah, University Student</small></div></div>
    <div class="col-md-6"><div class="tile-soft h-100"><p>"I was impressed by the quality of research and the attention to detail. Highly recommended!"</p><small>- Daniel, Graduate Student</small></div></div>
  </div>
</section>

<section class="mb-5">
  <h2 class="section-title">Student Success Stories</h2>
  <div class="row g-3">
    <div class="col-md-6"><div class="tile-soft h-100"><h5>Dissertation Rescue (Nursing)</h5><p class="mb-1">Challenge: weak methodology chapter and deadline pressure.</p><p class="mb-0">Outcome: revised structure, evidence-backed data interpretation, and on-time submission with supervisor approval.</p></div></div>
    <div class="col-md-6"><div class="tile-soft h-100"><h5>Data Analysis Support (Business)</h5><p class="mb-1">Challenge: complex dataset and unclear narrative.</p><p class="mb-0">Outcome: clear analysis framework, visualized findings, and stronger argument quality for final grading.</p></div></div>
  </div>
</section>

<section class="mb-5">
  <h2 class="section-title text-center">Accreditation & Quality Badges</h2>
  <div class="d-flex flex-wrap justify-content-center gap-3">
    <span class="badge bg-light text-dark border p-2">Academic Integrity Standard</span>
    <span class="badge bg-light text-dark border p-2">Secure Payments Verified</span>
    <span class="badge bg-light text-dark border p-2">Confidential Workflow Certified</span>
  </div>
</section>

<section class="mb-5" id="blog">
  <h2 class="section-title">Blog / Resources</h2>
  <ul class="list-group">
    <li class="list-group-item"><a href="{{ url_for('main.public_blogs') }}?q=thesis statement">How to Write a Strong Thesis Statement</a></li>
    <li class="list-group-item"><a href="{{ url_for('main.public_blogs') }}?q=study hacks">Top 5 Study Hacks for Busy Students</a></li>
    <li class="list-group-item"><a href="{{ url_for('main.public_blogs') }}?q=plagiarism">Avoiding Plagiarism: A Student’s Guide</a></li>
  </ul>
</section>

<section class="cta-band text-center py-4 mb-3">
  <h2 class="h3 fw-bold">Ready to Ace Your Papers?</h2>
  <p class="mb-3">Get started today with expert academic support.</p>
  <a href="{{ url_for('main.order') }}" class="btn btn-warning btn-lg">Place Order</a>
</section>

<div class="guest-float-stack" aria-label="Guest support tools">
  <button id="guestAiFab" class="guest-fab ai" type="button" title="AI Support" aria-label="Open AI support">
    <img src="{{ url_for('static', filename='img/logo-quill.jpg') }}" alt="AcademicPro AI" class="guest-fab-logo">
  </button>
  {% if not current_user.is_authenticated %}
  <button id="guestMsgFab" class="guest-fab msg" type="button" title="Message Admin" aria-label="Message admin">💬</button>
  {% endif %}
</div>

<div id="guestAiPanel" class="guest-panel d-none" role="dialog" aria-label="AI support assistant">
  <div class="guest-panel-head">
    <strong>AI Support</strong>
    <button type="button" class="btn-close btn-close-sm" data-close="guestAiPanel" aria-label="Close"></button>
  </div>
  <div id="guestAiBody" class="guest-panel-body">
    <div class="guest-bubble bot">Ask me about orders, deadlines, writers, or payments.</div>
  </div>
  <form id="guestAiForm" class="guest-panel-foot">
    <input id="guestAiInput" class="form-control form-control-sm" placeholder="Type your question..." required>
    <button class="btn btn-primary btn-sm" type="submit">Ask</button>
  </form>
</div>

{% if not current_user.is_authenticated %}
<div id="guestMsgPanel" class="guest-panel d-none" role="dialog" aria-label="Guest message panel">
  <div class="guest-panel-head">
    <strong>Message Admin</strong>
    <button type="button" class="btn-close btn-close-sm" data-close="guestMsgPanel" aria-label="Close"></button>
  </div>
  <div class="guest-panel-body">
    <div class="small text-muted mb-2">For follow-up, include your email.</div>
    <div class="mb-2">
      <input id="guestMsgEmail" class="form-control form-control-sm" placeholder="Email (optional)">
    </div>
    <div class="mb-2">
      <textarea id="guestMsgInput" rows="4" class="form-control form-control-sm" placeholder="Type your message..." required></textarea>
    </div>
    <div id="guestMsgStatus" class="small text-muted"></div>
  </div>
  <div class="guest-panel-foot">
    <button id="guestMsgSendBtn" class="btn btn-primary btn-sm w-100" type="button">Send Message</button>
  </div>
</div>

<div class="position-fixed top-0 end-0 p-3" style="z-index: 1080;">
  <div id="guestWelcomeToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto">Welcome to AcademicPro</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
      We noticed you are visiting as a guest. Create an account to access full order tracking, writer chat, and advanced features.
      <div class="mt-2 d-flex gap-2">
        <a class="btn btn-sm btn-primary" href="{{ url_for('main.register') }}">Create Account</a>
        <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('main.login') }}">Sign In</a>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
  (function () {
    const aiFab = document.getElementById("guestAiFab");
    const msgFab = document.getElementById("guestMsgFab");
    const aiPanel = document.getElementById("guestAiPanel");
    const msgPanel = document.getElementById("guestMsgPanel");

    function togglePanel(panel) {
      panel.classList.toggle("d-none");
    }

    if (aiFab && aiPanel) aiFab.addEventListener("click", function () { togglePanel(aiPanel); });
    if (msgFab && msgPanel) msgFab.addEventListener("click", function () { togglePanel(msgPanel); });

    document.querySelectorAll("[data-close]").forEach(function (btn) {
      btn.addEventListener("click", function () {
        const id = btn.getAttribute("data-close");
        const panel = document.getElementById(id);
        if (panel) panel.classList.add("d-none");
      });
    });

    const aiForm = document.getElementById("guestAiForm");
    const aiInput = document.getElementById("guestAiInput");
    const aiBody = document.getElementById("guestAiBody");
    if (aiForm && aiInput && aiBody) {
      aiForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        const question = aiInput.value.trim();
        if (!question) return;
        aiBody.insertAdjacentHTML("beforeend", '<div class="guest-bubble me">' + question + "</div>");
        aiInput.value = "";
        try {
          const res = await fetch("{{ url_for('main.guest_ai_ask') }}", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question })
          });
          const data = await res.json();
          aiBody.insertAdjacentHTML("beforeend", '<div class="guest-bubble bot">' + (data.answer || "Please try again.") + "</div>");
          aiBody.scrollTop = aiBody.scrollHeight;
        } catch (_err) {
          aiBody.insertAdjacentHTML("beforeend", '<div class="guest-bubble bot">Unable to answer right now.</div>');
        }
      });
    }

    const sendBtn = document.getElementById("guestMsgSendBtn");
    const msgInput = document.getElementById("guestMsgInput");
    const msgEmail = document.getElementById("guestMsgEmail");
    const msgStatus = document.getElementById("guestMsgStatus");
    if (sendBtn && msgInput && msgStatus) {
      sendBtn.addEventListener("click", async function () {
        const message = msgInput.value.trim();
        const email = msgEmail ? msgEmail.value.trim() : "";
        if (!message) {
          msgStatus.textContent = "Message cannot be empty.";
          return;
        }
        msgStatus.textContent = "Sending...";
        try {
          const res = await fetch("{{ url_for('main.guest_chat_send') }}", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, message })
          });
          const data = await res.json();
          if (!res.ok || !data.ok) {
            msgStatus.textContent = data.error || "Failed to send.";
            return;
          }
          msgInput.value = "";
          msgStatus.textContent = data.message || "Message sent.";
        } catch (_err) {
          msgStatus.textContent = "Network error. Try again.";
        }
      });
    }

    const guestToast = document.getElementById("guestWelcomeToast");
    if (guestToast && !sessionStorage.getItem("guest_welcome_seen")) {
      const toast = new bootstrap.Toast(guestToast, { delay: 9000 });
      toast.show();
      sessionStorage.setItem("guest_welcome_seen", "1");
    }
  })();
</script>
{% endblock %}
