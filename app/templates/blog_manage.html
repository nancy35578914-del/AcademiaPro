{% extends "base.html" %}
{% block title %}Manage Blog | AcademicPro{% endblock %}
{% block content %}
<div class="container py-4" style="max-width: 1080px;">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
    <div>
      <h2 class="mb-1">Blog Manager</h2>
      <p class="text-muted mb-0">Admins and approved writers can publish pillar and cluster posts.</p>
    </div>
    {% if current_user.is_admin %}
      <a href="{{ url_for('main.admin_dashboard') }}" class="btn btn-outline-secondary btn-sm">Back to Admin</a>
    {% else %}
      <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary btn-sm">Back to Dashboard</a>
    {% endif %}
  </div>

  <div class="section-card mb-4">
    <h5 class="mb-3">Create Blog Post</h5>
    <form method="POST" class="row g-3">
      <div class="col-md-8">
        <label class="form-label">Title</label>
        <input name="title" class="form-control" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Category</label>
        <input name="category" class="form-control" placeholder="Research Writing" value="Academic Skills">
      </div>
      <div class="col-md-6">
        <label class="form-label">Pillar</label>
        <input name="pillar" class="form-control" placeholder="Thesis Writing">
      </div>
      <div class="col-md-6">
        <label class="form-label">Cluster Topic</label>
        <input name="cluster_topic" class="form-control" placeholder="Time Management">
      </div>
      <div class="col-12">
        <label class="form-label">Excerpt</label>
        <textarea name="excerpt" class="form-control" rows="2" placeholder="Short summary shown on blog cards"></textarea>
      </div>
      <div class="col-12">
        <label class="form-label">Content</label>
        <textarea name="content" class="form-control" rows="10" required></textarea>
      </div>
      <div class="col-12 form-check ms-1">
        <input class="form-check-input" type="checkbox" name="is_published" id="is_published" checked>
        <label class="form-check-label" for="is_published">Publish immediately</label>
      </div>
      <div class="col-12">
        <button class="btn btn-primary" type="submit">Publish Post</button>
      </div>
    </form>
  </div>

  <div class="section-card">
    <h5 class="mb-3">Published & Draft Posts</h5>
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Title</th>
            <th>Category</th>
            <th>Pillar/Cluster</th>
            <th>Author</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for post in posts %}
          <tr>
            <td>
              <strong>{{ post.title }}</strong>
              <div class="small text-muted">{{ post.created_at.strftime('%Y-%m-%d') if post.created_at else '' }}</div>
            </td>
            <td>{{ post.category or 'Academic Skills' }}</td>
            <td>
              <div class="small">{{ post.pillar or '-' }}</div>
              <div class="small text-muted">{{ post.cluster_topic or '-' }}</div>
            </td>
            <td>{{ post.author_name or 'AcademicPro Team' }}</td>
            <td>
              {% if post.is_published %}
                <span class="badge bg-success">Published</span>
              {% else %}
                <span class="badge bg-secondary">Draft</span>
              {% endif %}
            </td>
            <td>
              <a href="{{ url_for('main.edit_blog', id=post.id) }}" class="btn btn-sm btn-outline-warning">Edit</a>
              <a href="{{ url_for('main.delete_blog', id=post.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this post?')">Delete</a>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="6" class="text-muted">No blog posts available.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
